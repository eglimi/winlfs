<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ExtFsr.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>ExtFsr.h</h1><a href="ExtFsr_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">  Semesterarbeit (SS 2003) - Ext2 File System Driver for Windows XP</span>
00003 <span class="comment">  Author: Michael Egli, Marc Winiger</span>
00004 <span class="comment"></span>
00005 <span class="comment">  CVS Information:</span>
00006 <span class="comment">    $Date: 2003/07/02 15:19:08 $</span>
00007 <span class="comment">    $Source: /cvsroot/winlfs/code/ExtFsr/ExtFsr.h,v $</span>
00008 <span class="comment">    $Revision: 1.15 $</span>
00009 <span class="comment">*/</span>
00010 
00026 <span class="preprocessor">#ifndef _EXTFSR_HEADER_</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define _EXTFSR_HEADER_</span>
00028 <span class="preprocessor"></span>
00029 <span class="preprocessor">#include &lt;ntdddisk.h&gt;</span>
00030 
00031 <span class="preprocessor">#pragma pack(1)</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#define SECTOR_SIZE (512)</span>
00033 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="structext3__super__block.html">00039</a> <span class="keyword">struct </span><a class="code" href="structext3__super__block.html">ext3_super_block</a>
00040 {
00041    <span class="comment">/* 00 */</span>
00042    ULONG s_inodes_count;        <span class="comment">// Inodes count </span>
00043    ULONG s_blocks_count;        <span class="comment">// Blocks count </span>
00044    ULONG s_r_blocks_count;      <span class="comment">// Reserved blocks count </span>
00045    ULONG s_free_blocks_count;   <span class="comment">// Free blocks count </span>
00046    <span class="comment">/* 10 */</span>
00047    ULONG s_free_inodes_count;   <span class="comment">// Free inodes count</span>
00048    ULONG s_first_data_block;    <span class="comment">// First Data Block</span>
00049    ULONG s_log_block_size;      <span class="comment">// Block size</span>
00050    LONG s_log_frag_size;        <span class="comment">// Fragment size</span>
00051    <span class="comment">/* 20 */</span>
00052    ULONG s_blocks_per_group;    <span class="comment">// # Blocks per group</span>
00053    ULONG s_frags_per_group;     <span class="comment">// # Fragments per group</span>
00054    ULONG s_inodes_per_group;    <span class="comment">// # Inodes per group</span>
00055    ULONG s_mtime;               <span class="comment">// Mount time</span>
00056    <span class="comment">/* 30 */</span>
00057    ULONG s_wtime;               <span class="comment">// Write time</span>
00058    USHORT s_mnt_count;          <span class="comment">// Mount count</span>
00059    SHORT s_max_mnt_count;       <span class="comment">// Maximal mount count</span>
00060 
<a name="l00066"></a><a class="code" href="structext3__super__block.html#m15">00066</a>    USHORT <a class="code" href="structext3__super__block.html#m15">s_magic</a>;
00067    USHORT s_state;              <span class="comment">// File system state</span>
00068    USHORT s_errors;             <span class="comment">// Behaviour when detecting errors</span>
00069    USHORT s_minor_rev_level;    <span class="comment">// minor revision level</span>
00070    <span class="comment">/* 40 */</span>
00071    ULONG s_lastcheck;           <span class="comment">// time of last check</span>
00072    ULONG s_checkinterval;       <span class="comment">// max. time between checks</span>
00073    ULONG s_creator_os;          <span class="comment">// OS</span>
00074    ULONG s_rev_level;           <span class="comment">// Revision level</span>
00075    <span class="comment">/* 50 */</span>
00076    USHORT s_def_resuid;         <span class="comment">// Default uid for reserved blocks</span>
00077    USHORT s_def_resgid;         <span class="comment">// Default gid for reserved blocks</span>
00078 
00079 <span class="comment">/*</span>
00080 <span class="comment"> * These fields are for EXT3_DYNAMIC_REV superblocks only.</span>
00081 <span class="comment"> *</span>
00082 <span class="comment"> * Note: the difference between the compatible feature set and</span>
00083 <span class="comment"> * the incompatible feature set is that if there is a bit set</span>
00084 <span class="comment"> * in the incompatible feature set that the kernel doesn't</span>
00085 <span class="comment"> * know about, it should refuse to mount the filesystem.</span>
00086 <span class="comment"> *</span>
00087 <span class="comment"> * e2fsck's requirements are more strict; if it doesn't know</span>
00088 <span class="comment"> * about a feature in either the compatible or incompatible</span>
00089 <span class="comment"> * feature set, it must abort and not try to meddle with</span>
00090 <span class="comment"> * things it doesn't understand...</span>
00091 <span class="comment"> */</span>
00092    ULONG s_first_ino;           <span class="comment">// First non-reserved inode</span>
00093    USHORT s_inode_size;         <span class="comment">// size of inode structure</span>
00094    USHORT s_block_group_nr;     <span class="comment">// block group # of this superblock</span>
00095 
<a name="l00101"></a><a class="code" href="structext3__super__block.html#m28">00101</a>    ULONG <a class="code" href="structext3__super__block.html#m28">s_feature_compat</a>;
00102 
00103 <span class="comment">/* 60 */</span>
00104    ULONG s_feature_incompat;    <span class="comment">// incompatible feature set</span>
00105    ULONG s_feature_ro_compat;   <span class="comment">// readonly-compatible feature set</span>
00106 
00107 <span class="comment">/* 68 */</span>
00108    UCHAR s_uuid[16];            <span class="comment">// 128-bit uuid for volume</span>
00109 
00110 <span class="comment">/* 78 */</span>
00111    CHAR s_volume_name[16];      <span class="comment">// volume name</span>
00112 
00113 <span class="comment">/* 88 */</span>
00114    CHAR s_last_mounted[64];     <span class="comment">// directory where last mounted</span>
00115 
00116 <span class="comment">/* C8 */</span>
00117    ULONG s_algorithm_usage_bitmap;      <span class="comment">// For compression</span>
00118 
00119 <span class="comment">/*</span>
00120 <span class="comment"> * Performance hints. Directory preallocation should only</span>
00121 <span class="comment"> * happen if the EXT3_FEATURE_COMPAT_DIR_PREALLOC flag is on.</span>
00122 <span class="comment"> */</span>
00123    UCHAR s_prealloc_blocks;     <span class="comment">// Nr of blocks to try to preallocate*/</span>
00124    UCHAR s_prealloc_dir_blocks; <span class="comment">// Nr to preallocate for dirs</span>
00125    USHORT s_padding1;
00126 
00127 <span class="comment">/*</span>
00128 <span class="comment"> * Journaling support valid if EXT3_FEATURE_COMPAT_HAS_JOURNAL set.</span>
00129 <span class="comment"> */</span>
00130 
00131 <span class="comment">/* D0 */</span>
00132    UCHAR s_journal_uuid[16];    <span class="comment">// uuid of journal superblock</span>
00133 
00134 <span class="comment">/* E0 */</span>
00135    ULONG s_journal_inum;        <span class="comment">// inode number of journal file</span>
00136    ULONG s_journal_dev;         <span class="comment">// device number of journal file</span>
00137    ULONG s_last_orphan;         <span class="comment">// start of list of inodes to delete</span>
00138 
00139 <span class="comment">/* EC */</span>
00140    ULONG s_reserved[197];       <span class="comment">// Padding to the end of the block</span>
00141 };
00142 
00143 <span class="preprocessor">#pragma pack()</span>
00144 <span class="preprocessor"></span>
00145 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structext3__super__block.html">ext3_super_block</a> EXT3_SUPER_BLOCK, *PEXT3_SUPER_BLOCK;
00146 
<a name="l00151"></a><a class="code" href="struct__LOAD__STATUS.html">00151</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__LOAD__STATUS.html">_LOAD_STATUS</a>
00152 {
<a name="l00153"></a><a class="code" href="struct__LOAD__STATUS.html#m0">00153</a>    BOOLEAN <a class="code" href="struct__LOAD__STATUS.html#m0">loaded</a>;              
<a name="l00154"></a><a class="code" href="struct__LOAD__STATUS.html#m1">00154</a>    BOOLEAN <a class="code" href="struct__LOAD__STATUS.html#m1">failed</a>;              
00155 } <a class="code" href="struct__LOAD__STATUS.html">LOAD_STATUS</a>, *<a class="code" href="struct__LOAD__STATUS.html">PLOAD_STATUS</a>;
00156 
<a name="l00161"></a><a class="code" href="struct__ExtFsrDeviceExtension.html">00161</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__ExtFsrDeviceExtension.html">_ExtFsrDeviceExtension</a>
00162 {
<a name="l00163"></a><a class="code" href="struct__ExtFsrDeviceExtension.html#m0">00163</a>    <a class="code" href="struct__LOAD__STATUS.html">LOAD_STATUS</a> <a class="code" href="struct__ExtFsrDeviceExtension.html#m0">ext3</a>;            
<a name="l00164"></a><a class="code" href="struct__ExtFsrDeviceExtension.html#m1">00164</a>    <a class="code" href="struct__LOAD__STATUS.html">LOAD_STATUS</a> <a class="code" href="struct__ExtFsrDeviceExtension.html#m1">ext2</a>;            
<a name="l00165"></a><a class="code" href="struct__ExtFsrDeviceExtension.html#m2">00165</a>    BOOLEAN <a class="code" href="struct__ExtFsrDeviceExtension.html#m2">journalling</a>;         
00166 } <a class="code" href="struct__ExtFsrDeviceExtension.html">ExtFsrDeviceExtension</a>, *<a class="code" href="struct__ExtFsrDeviceExtension.html">DEVICE_EXTENSION</a>;
00167 
00168 <span class="preprocessor">#define EXT_SUPER_MAGIC 0xEF53</span>
00169 <span class="preprocessor"></span>
00170 <span class="preprocessor">#define EXT3_FEATURE_COMPAT_HAS_JOURNAL 0x0004</span>
00171 <span class="preprocessor"></span><span class="preprocessor">#define EXT3_HAS_COMPAT_FEATURE(sb,mask) ( sb-&gt;s_feature_compat &amp; mask )</span>
00172 <span class="preprocessor"></span>
00173 <span class="preprocessor">#define DRIVER_NAME "ExtFsr"</span>
00174 <span class="preprocessor"></span><span class="preprocessor">#define FSD_RECOGNIZER_NAME L"\\FileSystem\\ExtFsRecognizer"</span>
00175 <span class="preprocessor"></span>
00176 <span class="preprocessor">#define EXTFSR_REGISTRY_PATH L"\\Registry\\Machine\\System\\CurrentControlSet\\Services\\ExtFsr"</span>
00177 <span class="preprocessor"></span>
00178 <span class="preprocessor">#define EXT2FSD_REGISTRY_PATH L"\\Registry\\Machine\\System\\CurrentControlSet\\Services\\Ext2Fsd"</span>
00179 <span class="preprocessor"></span>
00180 <span class="preprocessor">#define EXT3FSD_REGISTRY_PATH L"\\Registry\\Machine\\System\\CurrentControlSet\\Services\\Ext3Fsd"</span>
00181 <span class="preprocessor"></span>
00182 PDEVICE_OBJECT ExtFsrDeviceObject = NULL;
00183 
00184 NTSTATUS <a class="code" href="ExtFsr_8c.html#a0">ReadDisk</a> (IN PDEVICE_OBJECT DeviceObject, IN LONGLONG Offset,
00185                    IN ULONG Length, OUT PVOID Buffer);
00186 
00187 PEXT3_SUPER_BLOCK <a class="code" href="ExtFsr_8c.html#a1">LoadSuperBlock</a> (IN PDEVICE_OBJECT DeviceObject);
00188 
00189 VOID <a class="code" href="ExtFsr_8c.html#a3">ExtFsrUnload</a> (IN PDRIVER_OBJECT DeviceObject);
00190 
00191 NTSTATUS <a class="code" href="ExtFsr_8c.html#a2">FileSystemControl</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp);
00192 
00193 <span class="preprocessor">#endif  // _EXTFSR_HEADER_</span>
00194 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Wed Jul 2 17:19:22 2003 for ExtFsr by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3 </small></address>
</body>
</html>
