<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ExtFsr.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>ExtFsr.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Complete file system recognizer.
<p>
This file contains all functions needed by file system recognizer.
<p>
<code>#include &lt;ifs/ntifs.h&gt;</code><br>
<code>#include "<a class="el" href="ExtFsr_8h-source.html">ExtFsr.h</a>"</code><br>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="ExtFsr_8c.html#a0">ReadDisk</a> (IN PDEVICE_OBJECT DeviceObject, IN LONGLONG Offset, IN ULONG Length, OUT PVOID Buffer)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Reads data from physical disk into memory.</em> <a href="#a0"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>PEXT3_SUPER_BLOCK&nbsp;</td><td valign=bottom><a class="el" href="ExtFsr_8c.html#a1">LoadSuperBlock</a> (IN PDEVICE_OBJECT DeviceObject)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Loads super block from disk.</em> <a href="#a1"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="ExtFsr_8c.html#a2">FileSystemControl</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Manage mount requests and loads file system drivers.</em> <a href="#a2"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="ExtFsr_8c.html#a3">ExtFsrUnload</a> (IN PDRIVER_OBJECT DriverObject)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Unload function.</em> <a href="#a3"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="ExtFsr_8c.html#a4">DriverEntry</a> (PDRIVER_OBJECT DriverObject, PUNICODE_STRING RegistryPath)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Entry point of this driver.</em> <a href="#a4"></a><em></em><br><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a4" doxytag="ExtFsr.c::DriverEntry"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DriverEntry </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PDRIVER_OBJECT&nbsp;</td>
          <td class="mdname" nowrap> <em>DriverObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>RegistryPath</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Entry point of this driver.
<p>
It initializes global variables and registers the file system.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DriverObject</em>&nbsp;</td><td>Points to the next-lower driver's device object representing the target device for the read operation. </td></tr>
    <tr><td valign=top><em>RegistryPath</em>&nbsp;</td><td>Pointer to a counted Unicode string specifying the path to the driver's registry key. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>If the routine succeeds, it must return STATUS_SUCCESS. Otherwise, it must return one of the error status values defined in ntstatus.h. </dd></dl>
    </td>
  </tr>
</table>
<a name="a3" doxytag="ExtFsr.c::ExtFsrUnload"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExtFsrUnload </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDRIVER_OBJECT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DriverObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unload function.
<p>
This function cleans up reserved resources if this driver is no longer in use.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DriverObject</em>&nbsp;</td><td>Points to the next-lower driver's device object representing the target device for the read operation. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a2" doxytag="ExtFsr.c::FileSystemControl"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FileSystemControl </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PIRP&nbsp;</td>
          <td class="mdname" nowrap> <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Manage mount requests and loads file system drivers.
<p>
This function manages IRP_MN_MOUNT_VOLUME and IRP_MN_LOAD_FILE_SYSTEM. If a ext3 file system is regocnized, it will try to load the ext3 driver. If that was not successfully, the next request of the higher level driver will try to load the ext2 file system.<p>
If ext2 and ext3 both either are loaded successfully or have failed to load, the file system recognizer unloads itself.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Points to the next-lower driver's device object representing the target device for the read operation. </td></tr>
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>I/O request packet. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>If the routine succeeds, it must return STATUS_SUCCESS. Otherwise, it must return one of the error status values defined in ntstatus.h. </dd></dl>
    </td>
  </tr>
</table>
<a name="a1" doxytag="ExtFsr.c::LoadSuperBlock"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PEXT3_SUPER_BLOCK LoadSuperBlock </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Loads super block from disk.
<p>
This function allocates memory from nonpaged pool for the super block. The superblock is 1024 bytes and the sector size is 512 bytes. So we need two times the SECTOR_SIZE. As an offset we also take two times SECTOR_SIZE because the super block is the second block on a partition.<p>
If the call of ReadDisk fails, the allocated memory will be freed and a null pointer will be returned. If a pointer to the buffer is returned, the allocated memory must be freed from calling function.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Device object of the mounted volume </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>PEXT3_SUPER_BLOCK </dd></dl>
    </td>
  </tr>
</table>
<a name="a0" doxytag="ExtFsr.c::ReadDisk"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReadDisk </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Offset</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reads data from physical disk into memory.
<p>
This function builds an IRP for a FSD request, calls the lower driver with this IRP and wait for the completion of this operation. The read data will be written to the Buffer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Points to the next-lower driver's device object representing the target device for the read operation. </td></tr>
    <tr><td valign=top><em>Offset</em>&nbsp;</td><td>Points to the offset on the disk to read from. </td></tr>
    <tr><td valign=top><em>Length</em>&nbsp;</td><td>Specifies the length, in bytes, of Buffer. </td></tr>
    <tr><td valign=top><em>Buffer</em>&nbsp;</td><td>Points to a buffer to receive data. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Status Status of the Operation </dd></dl>
    </td>
  </tr>
</table>
<hr><address style="align: right;"><small>Generated on Wed Jul 2 17:19:22 2003 for ExtFsr by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3 </small></address>
</body>
</html>
