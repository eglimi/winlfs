<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ext2.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>ext2.h</h1><a href="ext2_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">  Semesterarbeit (SS 2003) - Ext2 File System Driver for Windows XP</span>
00003 <span class="comment">  Author: Michael Egli, Marc Winiger</span>
00004 <span class="comment"></span>
00005 <span class="comment">  Description: Headerfile for ext2.c, super.c, group.c, inode.c and cache.c</span>
00006 <span class="comment"></span>
00007 <span class="comment">  CVS Information:</span>
00008 <span class="comment">    $Date: 2003/07/02 15:19:08 $</span>
00009 <span class="comment">    $Source: /cvsroot/winlfs/code/Ext2Fsd/src/ext2.h,v $</span>
00010 <span class="comment">    $Revision: 1.11 $</span>
00011 <span class="comment">*/</span>
00012 
00021 <span class="preprocessor">#ifndef _EXT2_H_</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define _EXT2_H_</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#if DBG</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define Ext2FsdBreakPoint()    DbgBreakPoint()</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define Ext2FsdBreakPoint()</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00029 <span class="preprocessor"></span>
00030 <span class="preprocessor">#ifdef DRIVER</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#include "ntifs.h"</span>
00032 <span class="preprocessor">#else</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#include "stdlib.h"</span>
00034 <span class="preprocessor">#include "windows.h"</span>
00035 <span class="preprocessor">#endif</span>
00036 <span class="preprocessor"></span>
00037 <span class="preprocessor">#include "cache.h"</span>
00038 
00039 <span class="comment">/*</span>
00040 <span class="comment"> *  Typedefs for Ext2. Mapping Linux types to windows types.</span>
00041 <span class="comment"> */</span>
00042 
00043 <span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">char</span> _s8;
00044 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> _u8;
00045 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byte;
00046 
00047 <span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">short</span> _s16;
00048 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> _u16;
00049 
00050 <span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">long</span> _s32;
00051 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> _u32;
00052 
00053 <span class="keyword">typedef</span> LARGE_INTEGER _s64;
00054 <span class="keyword">typedef</span> ULARGE_INTEGER _u64;
00055 
00056 <span class="comment">/*</span>
00057 <span class="comment"> * Special inodes numbers</span>
00058 <span class="comment"> */</span>
00059 
00060 <span class="preprocessor">#define EXT2_BAD_INODE           1      </span><span class="comment">/* Bad blocks inode */</span>
00061 <span class="preprocessor">#define EXT2_ROOT_INODE          2      </span><span class="comment">/* Root inode */</span>
00062 <span class="preprocessor">#define EXT2_ACL_IDX_INODE       3      </span><span class="comment">/* ACL inode */</span>
00063 <span class="preprocessor">#define EXT2_ACL_DATA_INODE      4      </span><span class="comment">/* ACL inode */</span>
00064 <span class="preprocessor">#define EXT2_BOOT_LOADER_INODE   5      </span><span class="comment">/* Boot loader inode */</span>
00065 <span class="preprocessor">#define EXT2_UNDEL_DIR_INODE     6      </span><span class="comment">/* Undelete directory inode */</span>
00066 <span class="preprocessor">#define EXT2_RESIZE_INODE                7      </span><span class="comment">/* Reserved group descriptors inode */</span>
00067 <span class="preprocessor">#define EXT2_JOURNAL_INODE       8      </span><span class="comment">/* Journal inode */</span>
00068 <span class="preprocessor">#define EXT2_GOOD_OLD_FIRST_INODE       11  </span><span class="comment">/* First non-reserved inode for old ext2 filesystems */</span>
00069 <span class="preprocessor">#define EXT2_SUPER_MAGIC 0xEF53</span>
00070 <span class="preprocessor"></span>
00071 <span class="comment">/*</span>
00072 <span class="comment"> * Feature set definitions</span>
00073 <span class="comment"> */</span>
00074 
00075 <span class="preprocessor">#define EXT2_HAS_COMPAT_FEATURE(sb,mask)                        \</span>
00076 <span class="preprocessor">        ( EXT2_SB(sb)-&gt;s_es-&gt;s_feature_compat &amp; cpu_to_le32(mask) )</span>
00077 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_HAS_RO_COMPAT_FEATURE(sb,mask)                     \</span>
00078 <span class="preprocessor">        ( EXT2_SB(sb)-&gt;s_es-&gt;s_feature_ro_compat &amp; cpu_to_le32(mask) )</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_HAS_INCOMPAT_FEATURE(sb,mask)                      \</span>
00080 <span class="preprocessor">        ( EXT2_SB(sb)-&gt;s_es-&gt;s_feature_incompat &amp; cpu_to_le32(mask) )</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_SET_COMPAT_FEATURE(sb,mask)                        \</span>
00082 <span class="preprocessor">        EXT2_SB(sb)-&gt;s_es-&gt;s_feature_compat |= cpu_to_le32(mask)</span>
00083 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_SET_RO_COMPAT_FEATURE(sb,mask)                     \</span>
00084 <span class="preprocessor">        EXT2_SB(sb)-&gt;s_es-&gt;s_feature_ro_compat |= cpu_to_le32(mask)</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_SET_INCOMPAT_FEATURE(sb,mask)                      \</span>
00086 <span class="preprocessor">        EXT2_SB(sb)-&gt;s_es-&gt;s_feature_incompat |= cpu_to_le32(mask)</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_CLEAR_COMPAT_FEATURE(sb,mask)                      \</span>
00088 <span class="preprocessor">        EXT2_SB(sb)-&gt;s_es-&gt;s_feature_compat &amp;= ~cpu_to_le32(mask)</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_CLEAR_RO_COMPAT_FEATURE(sb,mask)                   \</span>
00090 <span class="preprocessor">        EXT2_SB(sb)-&gt;s_es-&gt;s_feature_ro_compat &amp;= ~cpu_to_le32(mask)</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_CLEAR_INCOMPAT_FEATURE(sb,mask)                    \</span>
00092 <span class="preprocessor">        EXT2_SB(sb)-&gt;s_es-&gt;s_feature_incompat &amp;= ~cpu_to_le32(mask)</span>
00093 <span class="preprocessor"></span>
00094 <span class="preprocessor">#define EXT2_FEATURE_COMPAT_DIR_PREALLOC        0x0001</span>
00095 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_COMPAT_IMAGIC_INODES       0x0002</span>
00096 <span class="preprocessor"></span><span class="preprocessor">#define EXT3_FEATURE_COMPAT_HAS_JOURNAL         0x0004</span>
00097 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_COMPAT_EXT_ATTR            0x0008</span>
00098 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_COMPAT_RESIZE_INO          0x0010</span>
00099 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_COMPAT_DIR_INDEX           0x0020</span>
00100 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_COMPAT_ANY                 0xffffffff</span>
00101 <span class="preprocessor"></span>
00102 <span class="preprocessor">#define EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER     0x0001</span>
00103 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_RO_COMPAT_LARGE_FILE       0x0002</span>
00104 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_RO_COMPAT_BTREE_DIR        0x0004</span>
00105 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_RO_COMPAT_ANY              0xffffffff</span>
00106 <span class="preprocessor"></span>
00107 <span class="preprocessor">#define EXT2_FEATURE_INCOMPAT_COMPRESSION       0x0001</span>
00108 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_INCOMPAT_FILETYPE          0x0002</span>
00109 <span class="preprocessor"></span><span class="preprocessor">#define EXT3_FEATURE_INCOMPAT_RECOVER           0x0004</span>
00110 <span class="preprocessor"></span><span class="preprocessor">#define EXT3_FEATURE_INCOMPAT_JOURNAL_DEV       0x0008</span>
00111 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_INCOMPAT_ANY               0xffffffff</span>
00112 <span class="preprocessor"></span>
00113 <span class="preprocessor">#define EXT2_FEATURE_COMPAT_SUPP        EXT2_FEATURE_COMPAT_EXT_ATTR</span>
00114 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_INCOMPAT_SUPP      EXT2_FEATURE_INCOMPAT_FILETYPE</span>
00115 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_RO_COMPAT_SUPP     (EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER| \</span>
00116 <span class="preprocessor">                                         EXT2_FEATURE_RO_COMPAT_LARGE_FILE| \</span>
00117 <span class="preprocessor">                                         EXT2_FEATURE_RO_COMPAT_BTREE_DIR)</span>
00118 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_RO_COMPAT_UNSUPPORTED      ~EXT2_FEATURE_RO_COMPAT_SUPP</span>
00119 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FEATURE_INCOMPAT_UNSUPPORTED       ~EXT2_FEATURE_INCOMPAT_SUPP</span>
00120 <span class="preprocessor"></span>
00121 <span class="preprocessor">#define EXT2_MIN_BLOCK  1024</span>
00122 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_MIN_FRAG   1024</span>
00123 <span class="preprocessor"></span>
00124 <span class="preprocessor">#define EXT2_INVALID_BLOCK 0</span>
00125 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_INVALID_INODE 0</span>
00126 <span class="preprocessor"></span>
00127 <span class="comment">/*</span>
00128 <span class="comment"> * Inode flags</span>
00129 <span class="comment"> */</span>
00130 <span class="preprocessor">#define S_IPERMISSION_MASK 0x1FF        </span><span class="comment">/*  */</span>
00131 
00132 <span class="preprocessor">#define S_IRWXU 0x01C0          </span><span class="comment">/*  00700 */</span>
00133 <span class="preprocessor">#define S_IRUSR 0x0100          </span><span class="comment">/*  00400 */</span>
00134 <span class="preprocessor">#define S_IWUSR 0x0080          </span><span class="comment">/*  00200 */</span>
00135 <span class="preprocessor">#define S_IXUSR 0x0040          </span><span class="comment">/*  00100 */</span>
00136 
00137 <span class="preprocessor">#define S_IRWXG 0x0038          </span><span class="comment">/*  00070 */</span>
00138 <span class="preprocessor">#define S_IRGRP 0x0020          </span><span class="comment">/*  00040 */</span>
00139 <span class="preprocessor">#define S_IWGRP 0x0010          </span><span class="comment">/*  00020 */</span>
00140 <span class="preprocessor">#define S_IXGRP 0x0008          </span><span class="comment">/*  00010 */</span>
00141 
00142 <span class="preprocessor">#define S_IRWXO 0x0007          </span><span class="comment">/*  00007 */</span>
00143 <span class="preprocessor">#define S_IROTH 0x0004          </span><span class="comment">/*  00004 */</span>
00144 <span class="preprocessor">#define S_IWOTH 0x0002          </span><span class="comment">/*  00002 */</span>
00145 <span class="preprocessor">#define S_IXOTH 0x0001          </span><span class="comment">/*  00001 */</span>
00146 
00147 <span class="preprocessor">#define S_IFMT   0x0F000        </span><span class="comment">/*017 0000 */</span>
00148 
00149 <span class="preprocessor">#define S_IFSOCK 0x0C000        </span><span class="comment">/*014 0000 */</span>
00150 <span class="preprocessor">#define S_IFLNK  0x0A000        </span><span class="comment">/*012 0000 */</span>
00151 <span class="preprocessor">#define S_IFFIL  0x08000        </span><span class="comment">/*010 0000 */</span>
00152 <span class="preprocessor">#define S_IFBLK  0x06000        </span><span class="comment">/*006 0000 */</span>
00153 <span class="preprocessor">#define S_IFDIR  0x04000        </span><span class="comment">/*004 0000 */</span>
00154 <span class="preprocessor">#define S_IFCHR  0x02000        </span><span class="comment">/*002 0000 */</span>
00155 <span class="preprocessor">#define S_IFIFO  0x01000        </span><span class="comment">/*001 0000 */</span>
00156 
00157 <span class="preprocessor">#define S_ISSOCK(m)     (((m) &amp; S_IFMT) == S_IFSOCK)</span>
00158 <span class="preprocessor"></span><span class="preprocessor">#define S_ISLNK(m)      (((m) &amp; S_IFMT) == S_IFLNK)</span>
00159 <span class="preprocessor"></span><span class="preprocessor">#define S_ISFIL(m)      (((m) &amp; S_IFMT) == S_IFFIL)</span>
00160 <span class="preprocessor"></span><span class="preprocessor">#define S_ISBLK(m)      (((m) &amp; S_IFMT) == S_IFBLK)</span>
00161 <span class="preprocessor"></span><span class="preprocessor">#define S_ISDIR(m)      (((m) &amp; S_IFMT) == S_IFDIR)</span>
00162 <span class="preprocessor"></span><span class="preprocessor">#define S_ISCHR(m)      (((m) &amp; S_IFMT) == S_IFCHR)</span>
00163 <span class="preprocessor"></span><span class="preprocessor">#define S_ISFIFO(m)     (((m) &amp; S_IFMT) == S_IFIFO)</span>
00164 <span class="preprocessor"></span>
00165 <span class="comment">/*not yet supported: */</span>
00166 <span class="preprocessor">#define S_IFUID  0x00800        </span><span class="comment">/*000 4000 */</span>
00167 <span class="preprocessor">#define S_IFGID  0x00400        </span><span class="comment">/*000 2000 */</span>
00168 <span class="preprocessor">#define S_IFVTX  0x00200        </span><span class="comment">/*000 1000 */</span>
00169 
00170 <span class="preprocessor">#define S_ISREADABLE(m)    (((m) &amp; S_IPERMISSION_MASK) == (S_IRUSR | S_IRGRP | S_IROTH))</span>
00171 <span class="preprocessor"></span><span class="preprocessor">#define S_ISWRITABLE(m)    (((m) &amp; S_IPERMISSION_MASK) == (S_IWUSR | S_IWGRP | S_IWOTH))</span>
00172 <span class="preprocessor"></span>
00173 <span class="preprocessor">#define Ext2FsdSetReadable(m) (m) = ((m) | (S_IRUSR | S_IRGRP | S_IROTH))</span>
00174 <span class="preprocessor"></span><span class="preprocessor">#define Ext2FsdSetWritable(m) (m) = ((m) | (S_IWUSR | S_IWGRP | S_IWOTH))</span>
00175 <span class="preprocessor"></span>
00176 <span class="preprocessor">#define Ext2FsdSetReadOnly(m) (m) = ((m) &amp; (~(S_IWUSR | S_IWGRP | S_IWOTH)))</span>
00177 <span class="preprocessor"></span><span class="preprocessor">#define Ext2FsdIsReadOnly(m)  (!((m) &amp; (S_IWUSR | S_IWGRP | S_IWOTH)))</span>
00178 <span class="preprocessor"></span>
00179 
00180 <span class="comment">/*</span>
00181 <span class="comment"> * Ext2 directory file types.  Only the low 3 bits are used.  The</span>
00182 <span class="comment"> * other bits are reserved for now.</span>
00183 <span class="comment"> */</span>
00184 
00185 <span class="preprocessor">#define EXT2_FT_UNKNOWN         0</span>
00186 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_REG_FILE        1</span>
00187 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_DIR                     2</span>
00188 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_CHRDEV          3</span>
00189 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_BLKDEV          4</span>
00190 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_FIFO            5</span>
00191 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_SOCK            6</span>
00192 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_SYMLINK         7</span>
00193 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_FT_MAX                     8</span>
00194 <span class="preprocessor"></span>
00195 <span class="preprocessor">#define EXT2_MIN_BLOCK_SIZE             1024</span>
00196 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_MAX_BLOCK_SIZE             4096</span>
00197 <span class="preprocessor"></span>
00198 <span class="preprocessor">#define DISK_BLOCK_SIZE  512UL  </span><span class="comment">/*size of harddisk sectors in byte */</span>
00199 
00200 <span class="preprocessor">#define TIMEZONEDIFF    7200    </span><span class="comment">/* (Your local time - GMT) *3600 */</span>
00201 <span class="preprocessor">#define TIMEZONE        TIMEZONEDIFF+14400</span>
00202 <span class="preprocessor"></span>
00203 <span class="preprocessor">#define EXT2_STATUS         _s32</span>
00204 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_STATUS_ERROR   FALSE</span>
00205 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_STATUS_OK      TRUE</span>
00206 <span class="preprocessor"></span>
00207 <span class="preprocessor">#define EXT2_NAME_LEN 255</span>
00208 <span class="preprocessor"></span>
00209 <span class="comment">/*</span>
00210 <span class="comment"> * EXT2_DIR_PAD defines the directory entries boundaries</span>
00211 <span class="comment"> *</span>
00212 <span class="comment"> * NOTE: It must be a multiple of 4</span>
00213 <span class="comment"> */</span>
00214 <span class="preprocessor">#define EXT2_DIR_PAD                    4</span>
00215 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_DIR_ROUND                  (EXT2_DIR_PAD - 1)</span>
00216 <span class="preprocessor"></span><span class="preprocessor">#define EXT2_DIR_REC_LEN(name_len)      (((name_len) + 8 + EXT2_DIR_ROUND) &amp; ~EXT2_DIR_ROUND)</span>
00217 <span class="preprocessor"></span>
00218 
<a name="l00225"></a><a class="code" href="structsuper__block__t.html">00225</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00226 <span class="keyword"></span>{
<a name="l00227"></a><a class="code" href="structsuper__block__t.html#m0">00227</a>    _u32 s_inodes_count;         
<a name="l00228"></a><a class="code" href="structsuper__block__t.html#m1">00228</a>    _u32 s_blocks_count;         
00229    _u32 s_r_blocks_count;       <span class="comment">/* Number of reserved blocks */</span>
00230    _u32 s_free_blocks_count;    <span class="comment">/* Free blocks count */</span>
00231    _u32 s_free_inodes_count;    <span class="comment">/* Free inodes count */</span>
00232    _u32 s_first_data_block;     <span class="comment">/* First Data Block */</span>
00233    _u32 s_log_block_size;       <span class="comment">/* Block size */</span>
00234    _s32 s_log_frag_size;        <span class="comment">/* Fragment size */</span>
<a name="l00235"></a><a class="code" href="structsuper__block__t.html#m8">00235</a>    _u32 s_blocks_per_group;     
00236    _u32 s_frags_per_group;      <span class="comment">/* # Fragments per group */</span>
<a name="l00237"></a><a class="code" href="structsuper__block__t.html#m10">00237</a>    _u32 s_inodes_per_group;     
00238    _u32 s_mtime;                <span class="comment">/* Mount time */</span>
00239    _u32 s_wtime;                <span class="comment">/* Write time */</span>
00240    _u16 s_mnt_count;            <span class="comment">/* Mount count */</span>
00241    _s16 s_max_mnt_count;        <span class="comment">/* Maximal mount count */</span>
00242  
<a name="l00248"></a><a class="code" href="structsuper__block__t.html#m15">00248</a>    _u16 s_magic;                <span class="comment">/* Magic signature */</span>
00249    _u16 s_state;                <span class="comment">/* File system state */</span>
00250    _u16 s_errors;               <span class="comment">/* Behaviour when detecting errors */</span>
00251    _u16 s_minor_rev_level;      <span class="comment">/* Minor revision level */</span>
00252    _u32 s_lastcheck;            <span class="comment">/* time of last check */</span>
00253    _u32 s_checkinterval;        <span class="comment">/* max. time between checks */</span>
00254    _u32 s_creator_os;           <span class="comment">/* OS */</span>
00255    _u32 s_rev_level;            <span class="comment">/* Revision level */</span>
00256    _u16 s_def_resuid;           <span class="comment">/* Default uid for reserved blocks */</span>
00257    _u16 s_def_resgid;           <span class="comment">/* Default gid for reserved blocks */</span>
00258 
00259    <span class="comment">/* These fields are for EXT2_DYNAMIC_REV superblocks only. */</span>
00260    _u32 s_first_ino;            <span class="comment">/* First non-reserved inode */</span>
00261    _u16 s_inode_size;           <span class="comment">/* size of inode structure */</span>
00262    _u16 s_block_group_nr;       <span class="comment">/* block group # of this superblock */</span>
00263    _u32 s_feature_compat;       <span class="comment">/* compatible feature set */</span>
00264    _u32 s_feature_incompat;     <span class="comment">/* incompatible feature set */</span>
00265    _u32 s_feature_ro_compat;    <span class="comment">/* readonly-compatible feature set */</span>
00266    _u32 s_pad[230];             <span class="comment">/* Padding to the end of the block */</span>
00267 }
00268 <a class="code" href="structsuper__block__t.html">super_block_t</a>;
00269 
<a name="l00276"></a><a class="code" href="structgroup__desc__t.html">00276</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00277 <span class="keyword"></span>{
<a name="l00278"></a><a class="code" href="structgroup__desc__t.html#m0">00278</a>    _u32 bg_block_bitmap;        
<a name="l00279"></a><a class="code" href="structgroup__desc__t.html#m1">00279</a>    _u32 bg_inode_bitmap;        
<a name="l00280"></a><a class="code" href="structgroup__desc__t.html#m2">00280</a>    _u32 bg_inode_table;         
<a name="l00281"></a><a class="code" href="structgroup__desc__t.html#m3">00281</a>    _u16 bg_free_blocks_count;   
<a name="l00282"></a><a class="code" href="structgroup__desc__t.html#m4">00282</a>    _u16 bg_free_inodes_count;   
00283    _u16 bg_used_dirs_count;     <span class="comment">/* Directories count */</span>
00284    _u16 bg_pad;
00285    _u32 bg_reserved[3];
00286 }
00287 <a class="code" href="structgroup__desc__t.html">group_desc_t</a>;
00288 
00289 <span class="comment">/*</span>
00290 <span class="comment"> * Inode Structure</span>
00291 <span class="comment"> */</span>
00292 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00293 <span class="keyword"></span>{
00294    _u16 i_mode;                 
00295    _u16 i_uid;                  <span class="comment">/* Owner Uid */</span>
00296    _u32 i_size;                 /&lt;!&lt; File size in bytes
00297    _u32 i_atime;                
00298    _u32 i_ctime;                
00299    _u32 i_mtime;                
00300    _u32 i_dtime;                
00301    _u16 i_gid;                  <span class="comment">/* Group Id */</span>
00302    _u16 i_links_count;          
00303    _u32 i_blocks;               
00304    _u32 i_flags;                
00305    _u32 i_reserved1;            <span class="comment">/* Reserved 1 */</span>
00306    _u32 i_block[15];            <span class="comment">/* Pointers to blocks */</span>
00307    _u32 i_version;              <span class="comment">/* File version (for NFS) */</span>
00308    _u32 i_file_acl;             <span class="comment">/* File ACL */</span>
00309    _u32 i_dir_acl;              <span class="comment">/* Directory ACL */</span>
00310    _u32 i_faddr;                <span class="comment">/* Fragment address */</span>
00311    _u8 i_frag;                  <span class="comment">/* Fragment number */</span>
00312    _u8 i_fsize;                 <span class="comment">/* Fragment size */</span>
00313    _u16 i_pad1;
00314    _u16 i_uid_high;             <span class="comment">/* high bits of uid */</span>
00315    _u16 i_gid_high;             <span class="comment">/* high bits of gid */</span>
00316    _u32 i_reserved2;
00317 <span class="comment">// _u32 i_reserved2[2];         /* Reserved 2 */</span>
00318 }
00319 inode_t;
00320 
00321 <span class="comment">/*</span>
00322 <span class="comment"> * Directory Structure</span>
00323 <span class="comment"> */</span>
00324 
00325 <span class="keyword">struct </span>dir
00326 {
00327    _u32 inode_num;
00328    _u16 rec_len;
00329    _u8 name_len;
00330    _u8 file_type;
00331    <span class="keywordtype">char</span> name[256];              <span class="comment">/* between 0 and 256 chars */</span>
00332 };
00333 
00334 
00335 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00336 <span class="keyword"></span>{
00337    _u32 entries;
00338    _u32 size_of_entry;
00339    ULONGLONG counter;
00340    _u8 *cache;
00341 }
00342 cache_t;
00343 
00344 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00345 <span class="keyword"></span>{
00346    _u32 index;
00347    ULONGLONG age;
00348    _u8 used;
00349    _u8 *data;
00350 }
00351 cache_header_t;
00352 
00353 
<a name="l00358"></a><a class="code" href="structext2__t.html">00358</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00359 <span class="keyword"></span>{
<a name="l00362"></a><a class="code" href="structext2__t.html#m0">00362</a>    <a class="code" href="structsuper__block__t.html">super_block_t</a> superblock;
00363 
<a name="l00366"></a><a class="code" href="structext2__t.html#m1">00366</a>    <a class="code" href="structgroup__desc__t.html">group_desc_t</a> *group_desc;
00367 
00368    _u32 num_groups;
00369 
00370    _u32 block_size;             <span class="comment">//Global variables calculated from the super block info</span>
00371    cache_t *inode_chache;
00372    cache_t *block_chache;
00373 <span class="preprocessor">#ifdef DRIVER</span>
00374 <span class="preprocessor"></span>   PDEVICE_OBJECT DeviceObject;
00375 <span class="preprocessor">#endif</span>
00376 <span class="preprocessor"></span>}
00377 <a class="code" href="structext2__t.html">ext2_t</a>;
00378 
00379 <span class="comment">/*</span>
00380 <span class="comment"> * Structure of a directory entry</span>
00381 <span class="comment"> */</span>
00382 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00383 <span class="keyword"></span>{
00384    _u32 inode;                  <span class="comment">/* Inode number */</span>
00385    _u16 rec_len;                <span class="comment">/* Directory entry length */</span>
00386    _u8 name_len;                <span class="comment">/* Name length */</span>
00387    _u8 file_type;
00388    <span class="keywordtype">char</span> name[EXT2_NAME_LEN + 1];        <span class="comment">/* File name */</span>
00389 }
00390 ext2_dir_entry_t, *pext2_dir_entry_t;
00391 
00392 <span class="comment">/*</span>
00393 <span class="comment"> * Structure and functions of a directory iterator</span>
00394 <span class="comment"> */</span>
00395 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00396 <span class="keyword"></span>{
00397    _u32 position;
00398    ext2_dir_entry_t ext2_dir_entry;
00399 }
00400 dir_iterator_t;
00401 
00402 dir_iterator_t *dir_iterator_create ();
00403 
00404 <span class="keywordtype">void</span> dir_iterator_dispose (dir_iterator_t * <span class="keyword">this</span>);
00405 
00406 <span class="comment">/*</span>
00407 <span class="comment"> * Ext2 functions</span>
00408 <span class="comment"> */</span>
00409 <a class="code" href="structext2__t.html">ext2_t</a> *ext2_create (<span class="keywordtype">void</span>);
00410 
00411 EXT2_STATUS ext2_init (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>);
00412 
00413 <span class="keywordtype">void</span> ext2_dispose (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>);
00414 
00415 <span class="comment">/*</span>
00416 <span class="comment"> * Superblock functions</span>
00417 <span class="comment"> */</span>
00418 EXT2_STATUS ext2_load_super (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>);
00419 
00420 <span class="keywordtype">void</span> ext2_print_super (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>);
00421 
00422 <span class="comment">/*</span>
00423 <span class="comment"> * Group functions</span>
00424 <span class="comment"> */</span>
00425 EXT2_STATUS ext2_load_groups (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>);
00426 
00427 <span class="keywordtype">void</span> ext2_print_groups (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>);
00428 
00429 <span class="comment">/*</span>
00430 <span class="comment"> * Inode functions</span>
00431 <span class="comment"> */</span>
00432 
00433 EXT2_STATUS ext2_load_inode (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>, inode_t * inode, _u32 inode_no);
00434 
00435 <span class="keywordtype">void</span> ext2_print_inode (inode_t * inode, _u32 inode_num);
00436 
00437 BOOLEAN ext2_inode_valid (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>, _u32 inode_no);
00438 
00439 _u32 ext2_resolve_softlink (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>, inode_t * inode, _u32 parent);
00440 
00441 EXT2_STATUS ext2_read_inode (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>, inode_t * inode, <span class="keywordtype">char</span> *buffer,
00442                              _u32 offset, _u32 size, _u32 * valid_size);
00443 
00444 _u32 ext2_lookup (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>, <span class="keywordtype">char</span> *file, _u32 inode_num);
00445 
00446 EXT2_STATUS ext2_list_dir (<a class="code" href="structext2__t.html">ext2_t</a> * <span class="keyword">this</span>, <span class="keywordtype">char</span> *buffer, _u32 size,
00447                            dir_iterator_t * dir_iterator);
00448 
00449 inode_t *<a class="code" href="alloc_8c.html#a7">Ext2FsdAllocateInode</a> ();
00450 
00451 <span class="keywordtype">void</span> <a class="code" href="alloc_8c.html#a8">Ext2FsdFreeInode</a> (inode_t * inode);
00452 
00453 <span class="comment">/*</span>
00454 <span class="comment"> * Time functions</span>
00455 <span class="comment"> */</span>
00456 
00457 <span class="preprocessor">#ifdef DRIVER</span>
00458 <span class="preprocessor"></span><span class="keywordtype">void</span> ext2_getAccessTimeNT (inode_t * inode, PLARGE_INTEGER TimeNT);
00459 <span class="keywordtype">void</span> ext2_getCreationTimeNT (inode_t * inode, PLARGE_INTEGER TimeNT);
00460 <span class="keywordtype">void</span> ext2_getDeletionTimeNT (inode_t * inode, PLARGE_INTEGER TimeNT);
00461 <span class="keywordtype">void</span> ext2_getModificationTimeNT (inode_t * inode, PLARGE_INTEGER TimeNT);
00462 <span class="preprocessor">#endif</span>
00463 <span class="preprocessor"></span>
00464 
00465 cache_t *cache_create (_u32 entries, _u32 size_of_entry);
00466 <span class="keywordtype">void</span> cache_add (cache_t * <span class="keyword">this</span>, _u32 index, <span class="keywordtype">void</span> *data);
00467 <span class="keywordtype">void</span> *cache_find (cache_t * <span class="keyword">this</span>, _u32 index, BOOLEAN aging);
00468 
00469 <span class="preprocessor">#endif </span><span class="comment">/* _EXT2_H_ */</span>
</pre></div><hr><address style="align: right;"><small>Generated on Wed Jul 2 17:19:24 2003 for Ext2Fsd by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3 </small></address>
</body>
</html>
