<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>fsd.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>fsd.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">  Semesterarbeit (SS 2003) - Ext2 File System Driver for Windows XP</span>
00003 <span class="comment">  Author: Michael Egli, Marc Winiger</span>
00004 <span class="comment"></span>
00005 <span class="comment">  Description: Headerfile for the ext2 file system driver</span>
00006 <span class="comment"></span>
00007 <span class="comment">  CVS Information:</span>
00008 <span class="comment">    $Date: 2003/07/02 08:34:48 $</span>
00009 <span class="comment">    $Source: /cvsroot/winlfs/code/Ext2Fsd/src/fsd.h,v $</span>
00010 <span class="comment">    $Revision: 1.14 $</span>
00011 <span class="comment">*/</span>
00012 
00013 <span class="preprocessor">#ifndef _FSD_</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#define _FSD_</span>
00015 <span class="preprocessor"></span>
00016 <span class="preprocessor">#include &lt;ntdddisk.h&gt;</span>
00017 <span class="preprocessor">#include "<a class="code" href="ext2_8h.html">ext2.h</a>"</span>
00018 
00019 <span class="preprocessor">#undef ASSERT</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define ASSERT(m) if(!(m)) {DbgPrint("ASSERT : %s(%d): %s\n", __FILE__, __LINE__, #m); for(;;);}</span>
00021 <span class="preprocessor"></span>
00022 <span class="comment">//</span>
00023 <span class="comment">// Name for the driver and it's main device</span>
00024 <span class="comment">//</span>
00025 <span class="preprocessor">#define DRIVER_NAME     "Ext2Fsd"</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define DEVICE_NAME     L"\\Ext2Fsd"</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#if DBG</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#define DOS_DEVICE_NAME L"\\DosDevices\\Ext2Fsd"</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span>
00031 <span class="comment">//</span>
00032 <span class="comment">// Define FSD_RO to compile a read-only driver</span>
00033 <span class="comment">//</span>
00034 <span class="comment">// Currently this is an implementation of a read-only driver and romfs was</span>
00035 <span class="comment">// designed for read-only use but some code needed for write support is</span>
00036 <span class="comment">// included anyway for use as documentation or a base for implementing a</span>
00037 <span class="comment">// writeable driver</span>
00038 <span class="comment">//</span>
00039 <span class="comment">//#define FSD_RO</span>
00040 
00041 <span class="comment">//</span>
00042 <span class="comment">// Comment out these to make all driver code nonpaged</span>
00043 <span class="comment">//</span>
00044 <span class="preprocessor">#define FSD_INIT_CODE   "INIT"</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define FSD_PAGED_CODE  "PAGE"</span>
00046 <span class="preprocessor"></span>
00047 <span class="comment">//</span>
00048 <span class="comment">// Private IOCTL to make the driver ready to unload</span>
00049 <span class="comment">//</span>
00050 <span class="preprocessor">#define IOCTL_PREPARE_TO_UNLOAD \</span>
00051 <span class="preprocessor">    CTL_CODE(FILE_DEVICE_UNKNOWN, 2048, METHOD_NEITHER, FILE_WRITE_ACCESS)</span>
00052 <span class="preprocessor"></span>
00053 <span class="preprocessor">#ifndef SetFlag</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#define SetFlag(x,f)    ((x) |= (f))</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span>
00057 <span class="preprocessor">#ifndef ClearFlag</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define ClearFlag(x,f)  ((x) &amp;= ~(f))</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>
00061 <span class="preprocessor">#define IsFlagOn(a,b) ((BOOLEAN)(FlagOn(a,b) ? TRUE : FALSE))</span>
00062 <span class="preprocessor"></span>
00063 <span class="keyword">typedef</span> PVOID PBCB;
00064 
00065 <span class="comment">//</span>
00066 <span class="comment">// FSD_IDENTIFIER_TYPE</span>
00067 <span class="comment">//</span>
00068 <span class="comment">// Identifiers used to mark the structures</span>
00069 <span class="comment">//</span>
00070 <span class="keyword">typedef</span> <span class="keyword">enum</span> _FSD_IDENTIFIER_TYPE
00071 {
00072    FGD = ':DGF',
00073    VCB = ':BCV',
00074    FCB = ':BCF',
00075    CCB = ':BCC',
00076    ICX = ':XCI',
00077    FSD = ':DSF'
00078 } FSD_IDENTIFIER_TYPE;
00079 
00080 <span class="comment">//</span>
00081 <span class="comment">// FSD_IDENTIFIER</span>
00082 <span class="comment">//</span>
00083 <span class="comment">// Header used to mark the structures</span>
00084 <span class="comment">//</span>
00085 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FSD_IDENTIFIER
00086 {
00087    FSD_IDENTIFIER_TYPE Type;
00088    ULONG Size;
00089 } FSD_IDENTIFIER, *PFSD_IDENTIFIER;
00090 
00091 <span class="comment">//</span>
00092 <span class="comment">// FSD_GLOBAL_DATA</span>
00093 <span class="comment">//</span>
00094 <span class="comment">// Data that is not specific to a mounted volume</span>
00095 <span class="comment">//</span>
00096 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FSD_GLOBAL_DATA
00097 {
00098 
00099    <span class="comment">// Identifier for this structure</span>
00100    FSD_IDENTIFIER Identifier;
00101 
00102    <span class="comment">// Syncronization primitive for this structure</span>
00103    ERESOURCE Resource;
00104 
00105    <span class="comment">// Pointer to the driver object</span>
00106    PDRIVER_OBJECT DriverObject;
00107 
00108    <span class="comment">// Pointer to the main device object</span>
00109    PDEVICE_OBJECT DeviceObject;
00110 
00111    <span class="comment">// List of mounted volumes</span>
00112    LIST_ENTRY VcbList;
00113 
00114    <span class="comment">// Global flags for the driver</span>
00115    ULONG Flags;
00116 
00117    ULONG Irps;
00118 
00119 } FSD_GLOBAL_DATA, *PFSD_GLOBAL_DATA;
00120 
00121 <span class="comment">//</span>
00122 <span class="comment">// Flags for FSD_GLOBAL_DATA</span>
00123 <span class="comment">//</span>
00124 <span class="preprocessor">#define FSD_UNLOAD_PENDING      0x00000001</span>
00125 <span class="preprocessor"></span>
00126 <span class="comment">//</span>
00127 <span class="comment">// The global data is declared in init.c</span>
00128 <span class="comment">//</span>
00129 <span class="keyword">extern</span> FSD_GLOBAL_DATA FsdGlobalData;
00130 
00131 <span class="comment">//</span>
00132 <span class="comment">// FSD_VCB Volume Control Block</span>
00133 <span class="comment">//</span>
00134 <span class="comment">// Data that represents a mounted logical volume</span>
00135 <span class="comment">// It is allocated as the device extension of the volume device object</span>
00136 <span class="comment">//</span>
00137 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FSD_VCB
00138 {
00139 
00140    <span class="comment">// FCB header required by NT</span>
00141    <span class="comment">// The VCB is also used as an FCB for file objects</span>
00142    <span class="comment">// that represents the volume itself</span>
00143    FSRTL_COMMON_FCB_HEADER CommonFCBHeader;
00144    SECTION_OBJECT_POINTERS SectionObject;
00145    ERESOURCE MainResource;
00146    ERESOURCE PagingIoResource;
00147    <span class="comment">// end FCB header required by NT</span>
00148 
00149    <span class="comment">// Identifier for this structure</span>
00150    FSD_IDENTIFIER Identifier;
00151 
00152    <span class="comment">// List of VCBs</span>
00153    LIST_ENTRY Next;
00154 
00155    <span class="comment">// Incremented on IRP_MJ_CREATE, decremented on IRP_MJ_CLEANUP</span>
00156    <span class="comment">// for files on this volume.</span>
00157    ULONG OpenFileHandleCount;
00158 
00159    <span class="comment">// Incremented on IRP_MJ_CREATE, decremented on IRP_MJ_CLOSE</span>
00160    <span class="comment">// for both files on this volume and open instances of the</span>
00161    <span class="comment">// volume itself.</span>
00162    ULONG ReferenceCount;
00163 
00164    <span class="comment">// Pointer to the VPB in the target device object</span>
00165    PVPB Vpb;
00166 
00167    <span class="comment">// List of FCBs for open files on this volume</span>
00168    LIST_ENTRY FcbList;
00169 
00170    <span class="comment">// List of IRPs pending on directory change notify requests</span>
00171    LIST_ENTRY NotifyList;
00172 
00173    <span class="comment">// Pointer to syncronization primitive for this list</span>
00174    PNOTIFY_SYNC NotifySync;
00175 
00176    <span class="comment">// This volumes device object</span>
00177    PDEVICE_OBJECT DeviceObject;
00178 
00179    <span class="comment">// The physical device object (the disk)</span>
00180    PDEVICE_OBJECT TargetDeviceObject;
00181 
00182    <span class="comment">// Information about the physical device object</span>
00183    DISK_GEOMETRY DiskGeometry;
00184    PARTITION_INFORMATION PartitionInformation;
00185 
00186    <span class="comment">// Pointer to the file system superblock</span>
00187    <a class="code" href="structext2__t.html">ext2_t</a> *ext2;
00188 
00189    <span class="comment">// Flags for the volume</span>
00190    ULONG Flags;
00191 
00192 } FSD_VCB, *PFSD_VCB;
00193 
00194 <span class="comment">//</span>
00195 <span class="comment">// Flags for FSD_VCB</span>
00196 <span class="comment">//</span>
00197 <span class="preprocessor">#define VCB_VOLUME_LOCKED       0x00000001</span>
00198 <span class="preprocessor"></span><span class="preprocessor">#define VCB_DISMOUNT_PENDING    0x00000002</span>
00199 <span class="preprocessor"></span><span class="preprocessor">#define VCB_READ_ONLY           0x00000004</span>
00200 <span class="preprocessor"></span>
00201 <span class="comment">//</span>
00202 <span class="comment">// FSD_FCB File Control Block</span>
00203 <span class="comment">//</span>
00204 <span class="comment">// Data that represents an open file</span>
00205 <span class="comment">// There is a single instance of the FCB for every open file</span>
00206 <span class="comment">//</span>
00207 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FSD_FCB
00208 {
00209 
00210    <span class="comment">// FCB header required by NT</span>
00211    FSRTL_COMMON_FCB_HEADER CommonFCBHeader;
00212    SECTION_OBJECT_POINTERS SectionObject;
00213    ERESOURCE MainResource;
00214    ERESOURCE PagingIoResource;
00215    <span class="comment">// end FCB header required by NT</span>
00216 
00217    <span class="comment">// Identifier for this structure</span>
00218    FSD_IDENTIFIER Identifier;
00219 
00220    <span class="comment">// List of FCBs for this volume</span>
00221    LIST_ENTRY Next;
00222 
00223 <span class="preprocessor">#ifndef FSD_RO</span>
00224 <span class="preprocessor"></span>   <span class="comment">// Share Access for the file object</span>
00225    SHARE_ACCESS ShareAccess;
00226 <span class="preprocessor">#endif</span>
00227 <span class="preprocessor"></span>
00228    <span class="comment">// List of byte-range locks for this file</span>
00229    FILE_LOCK FileLock;
00230 
00231    <span class="comment">// Incremented on IRP_MJ_CREATE, decremented on IRP_MJ_CLEANUP</span>
00232    ULONG OpenHandleCount;
00233 
00234    <span class="comment">// Incremented on IRP_MJ_CREATE, decremented on IRP_MJ_CLOSE</span>
00235    ULONG ReferenceCount;
00236 
00237    <span class="comment">// The filename</span>
00238    UNICODE_STRING FileName;
00239    ANSI_STRING AnsiFileName;
00240 
00241    <span class="comment">// The file attributes</span>
00242    ULONG FileAttributes;
00243 
00244    <span class="comment">// The inode number</span>
00245    ULONG IndexNumber;
00246 
00247    <span class="comment">// Flags for the FCB</span>
00248    ULONG Flags;
00249 
00250    <span class="comment">// Pointer to the inode</span>
00251    inode_t *inode;
00252 
00253    <span class="comment">// List of CCBs for this FCB</span>
00254    LIST_ENTRY FirstCCB;
00255 
00256 } FSD_FCB, *PFSD_FCB;
00257 
00258 <span class="comment">//</span>
00259 <span class="comment">// Flags for FSD_FCB</span>
00260 <span class="comment">//</span>
00261 <span class="preprocessor">#define FCB_PAGE_FILE               0x00000001</span>
00262 <span class="preprocessor"></span><span class="preprocessor">#define FCB_DELETE_PENDING          0x00000002</span>
00263 <span class="preprocessor"></span>
00264 <span class="comment">//</span>
00265 <span class="comment">// FSD_CCB Context Control Block</span>
00266 <span class="comment">//</span>
00267 <span class="comment">// Data that represents one instance of an open file</span>
00268 <span class="comment">// There is one instance of the CCB for every instance of an open file</span>
00269 <span class="comment">//</span>
00270 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FSD_CCB
00271 {
00272 
00273    <span class="comment">// Identifier for this structure</span>
00274    FSD_IDENTIFIER Identifier;
00275 
00276    <span class="comment">// State that may need to be maintained</span>
00277    ULONG FileIndex;
00278 
00279 
00280    UNICODE_STRING DirectorySearchPattern;
00281 
00282    <span class="comment">// Pointer to the next CCB</span>
00283    LIST_ENTRY NextCCB;
00284 
00285    <span class="comment">// Related FCB</span>
00286    PFSD_FCB PtrFCB;
00287 
00288 } FSD_CCB, *PFSD_CCB;
00289 
<a name="l00295"></a><a class="code" href="struct__FSD__IRP__CONTEXT.html">00295</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__FSD__IRP__CONTEXT.html">_FSD_IRP_CONTEXT</a>
00296 {
00297 
00298    <span class="comment">// Identifier for this structure</span>
00299    FSD_IDENTIFIER Identifier;
00300 
<a name="l00303"></a><a class="code" href="struct__FSD__IRP__CONTEXT.html#m1">00303</a>    PIRP <a class="code" href="struct__FSD__IRP__CONTEXT.html#m1">Irp</a>;
00304 
00305    <span class="comment">// The major and minor function code for the request</span>
<a name="l00306"></a><a class="code" href="struct__FSD__IRP__CONTEXT.html#m2">00306</a>    UCHAR <a class="code" href="struct__FSD__IRP__CONTEXT.html#m2">MajorFunction</a>;          
<a name="l00307"></a><a class="code" href="struct__FSD__IRP__CONTEXT.html#m3">00307</a>    UCHAR <a class="code" href="struct__FSD__IRP__CONTEXT.html#m3">MinorFunction</a>;          
00308 
00309    <span class="comment">// The device object</span>
<a name="l00310"></a><a class="code" href="struct__FSD__IRP__CONTEXT.html#m4">00310</a>    PDEVICE_OBJECT <a class="code" href="struct__FSD__IRP__CONTEXT.html#m4">DeviceObject</a>;  
00311 
00312    <span class="comment">// The file object</span>
00313    PFILE_OBJECT FileObject;
00314 
00315    <span class="comment">// If the request is synchronous (we are allowed to block)</span>
00316    BOOLEAN IsSynchronous;
00317 
00318    <span class="comment">// If the request is top level</span>
00319    BOOLEAN IsTopLevel;
00320 
00321    <span class="comment">// Used if the request needs to be queued for later processing</span>
00322    WORK_QUEUE_ITEM WorkQueueItem;
00323 
00324    <span class="comment">// If an exception is currently in progress</span>
00325    BOOLEAN ExceptionInProgress;
00326 
00327    <span class="comment">// The exception code when an exception is in progress</span>
00328    NTSTATUS ExceptionCode;
00329 
00330 } <a class="code" href="struct__FSD__IRP__CONTEXT.html">FSD_IRP_CONTEXT</a>, *<a class="code" href="struct__FSD__IRP__CONTEXT.html">PFSD_IRP_CONTEXT</a>;
00331 
00332 <span class="comment">//</span>
00333 <span class="comment">// FSD_ALLOC_HEADER</span>
00334 <span class="comment">//</span>
00335 <span class="comment">// In the checked version of the driver this header is put in the beginning of</span>
00336 <span class="comment">// every memory allocation</span>
00337 <span class="comment">//</span>
00338 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FSD_ALLOC_HEADER
00339 {
00340    FSD_IDENTIFIER Identifier;
00341 } FSD_ALLOC_HEADER, *PFSD_ALLOC_HEADER;
00342 
00343 <span class="comment">//</span>
00344 <span class="comment">// Function prototypes from alloc.c</span>
00345 <span class="comment">//</span>
00346 
00347 <span class="preprocessor">#if DBG</span>
00348 <span class="preprocessor"></span>
00349 PVOID Ext2FsdAllocatePool (IN POOL_TYPE PoolType, IN ULONG NumberOfBytes,
00350                            IN ULONG Tag);
00351 
00352 VOID Ext2FsdFreePool (IN PVOID p);
00353 
00354 <span class="preprocessor">#else // !DBG</span>
00355 <span class="preprocessor"></span>
00356 <span class="preprocessor">#define Ext2FsdAllocatePool(PoolType, NumberOfBytes, Tag) \</span>
00357 <span class="preprocessor">        ExAllocatePool(PoolType, NumberOfBytes)</span>
00358 <span class="preprocessor"></span>
00359 <span class="preprocessor">#define Ext2FsdFreePool(p) \</span>
00360 <span class="preprocessor">        ExFreePool(p)</span>
00361 <span class="preprocessor"></span>
00362 <span class="preprocessor">#endif // !DBG</span>
00363 <span class="preprocessor"></span>
00364 PFSD_IRP_CONTEXT Ext2FsdAllocateIrpContext (IN PDEVICE_OBJECT DeviceObject,
00365                                             IN PIRP Irp);
00366 
00367 VOID Ext2FsdFreeIrpContext (IN PFSD_IRP_CONTEXT IrpContext);
00368 
00369 PFSD_FCB Ext2FsdAllocateFcb (IN PFSD_VCB Vcb, IN PUNICODE_STRING FileName,
00370                              IN ULONG IndexNumber, IN inode_t * inode);
00371 
00372 VOID Ext2FsdFreeFcb (IN PFSD_FCB Fcb);
00373 
00374 PFSD_CCB Ext2FsdAllocateCcb (VOID);
00375 
00376 VOID Ext2FsdFreeCcb (IN PFSD_CCB Ccb);
00377 
00378 VOID Ext2FsdFreeVcb (IN PFSD_VCB Vcb);
00379 
00380 <span class="comment">//</span>
00381 <span class="comment">// Function prototypes from blockdev.c</span>
00382 <span class="comment">//</span>
00383 
00384 NTSTATUS Ext2ReadSync (IN PDEVICE_OBJECT DeviceObject, IN LONGLONG Offset,
00385                        IN ULONG Length, OUT PVOID Buffer, BOOLEAN bVerify);
00386 
00387 NTSTATUS FsdBlockDeviceIoControl (IN PDEVICE_OBJECT DeviceObject,
00388                                   IN ULONG IoctlCode, IN PVOID InputBuffer,
00389                                   IN ULONG InputBufferSize,
00390                                   IN OUT PVOID OutputBuffer,
00391                                   IN OUT PULONG OutputBufferSize);
00392 
00393 NTSTATUS FsdReadWriteBlockDevice (IN ULONG Operation,
00394                                   IN PDEVICE_OBJECT DeviceObject,
00395                                   IN PLARGE_INTEGER Offset, IN ULONG Length,
00396                                   IN BOOLEAN OverrideVerify,
00397                                   IN OUT PVOID Buffer);
00398 
00399 NTSTATUS FsdReadWriteBlockDeviceCompletion (IN PDEVICE_OBJECT DeviceObject,
00400                                             IN PIRP Irp, IN PVOID Context);
00401 
00402 <span class="comment">//</span>
00403 <span class="comment">// Function prototypes from char.c</span>
00404 <span class="comment">//</span>
00405 
00406 VOID FsdCharToWchar (IN OUT PWCHAR Destination, IN PCHAR Source,
00407                      IN ULONG Length);
00408 
00409 NTSTATUS FsdWcharToChar (IN OUT PCHAR Destination, IN PWCHAR Source,
00410                          IN ULONG Length);
00411 
00412 <span class="comment">//</span>
00413 <span class="comment">// Function prototypes from cleanup.c</span>
00414 <span class="comment">//</span>
00415 
00416 NTSTATUS Ext2FsdCleanup (IN PFSD_IRP_CONTEXT IrpContext);
00417 
00418 <span class="comment">//</span>
00419 <span class="comment">// Function prototypes from close.c</span>
00420 <span class="comment">//</span>
00421 
00422 NTSTATUS Ext2FsdClose (IN PFSD_IRP_CONTEXT IrpContext);
00423 
00424 VOID Ext2FsdQueueCloseRequest (IN PFSD_IRP_CONTEXT IrpContext);
00425 
00426 VOID Ext2FsdDeQueueCloseRequest (IN PVOID Context);
00427 
00428 
00429 <span class="comment">//</span>
00430 <span class="comment">// Function prototypes from create.c</span>
00431 <span class="comment">//</span>
00432 
00433 NTSTATUS Ext2FsdCreate (IN PFSD_IRP_CONTEXT IrpContext);
00434 
00435 NTSTATUS Ext2FsdCreateFs (IN PFSD_IRP_CONTEXT IrpContext);
00436 
00437 NTSTATUS Ext2FsdCreateVolume (IN PFSD_IRP_CONTEXT IrpContext);
00438 
00439 NTSTATUS <a class="code" href="create_8c.html#a3">Ext2FsdCreateFile</a> (IN PFSD_IRP_CONTEXT IrpContext);
00440 
00441 PFSD_FCB <a class="code" href="create_8c.html#a4">FsdLookupFcbByFileName</a> (IN PFSD_VCB Vcb,
00442                                  IN PUNICODE_STRING FullFileName);
00443 
00444 <span class="comment">//</span>
00445 <span class="comment">// Function prototypes from debug.c</span>
00446 <span class="comment">//</span>
00447 
00448 <span class="preprocessor">#if DBG</span>
00449 <span class="preprocessor"></span>
00450 <span class="keyword">extern</span> ULONG ProcessNameOffset;
00451 
00452 <span class="preprocessor">#define FsdGetCurrentProcessName() ( \</span>
00453 <span class="preprocessor">    (PUCHAR) PsGetCurrentProcess() + ProcessNameOffset \</span>
00454 <span class="preprocessor">)</span>
00455 <span class="preprocessor"></span>
00456 ULONG FsdGetProcessNameOffset (VOID);
00457 
00458 VOID Ext2FsdDbgPrintCall (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp);
00459 
00460 VOID FsdDbgPrintComplete (IN PIRP Irp);
00461 
00462 PUCHAR FsdNtStatusToString (IN NTSTATUS Status);
00463 
00464 <span class="preprocessor">#define FsdCompleteRequest(Irp, PriorityBoost) \</span>
00465 <span class="preprocessor">        FsdDbgPrintComplete(Irp); \</span>
00466 <span class="preprocessor">        IoCompleteRequest(Irp, PriorityBoost)</span>
00467 <span class="preprocessor"></span>
00468 <span class="preprocessor">#else // !DBG</span>
00469 <span class="preprocessor"></span>
00470 <span class="preprocessor">#define FsdDbgPrintCall(DeviceObject, Irp)</span>
00471 <span class="preprocessor"></span>
00472 <span class="preprocessor">#define FsdCompleteRequest(Irp, PriorityBoost) \</span>
00473 <span class="preprocessor">        IoCompleteRequest(Irp, PriorityBoost)</span>
00474 <span class="preprocessor"></span>
00475 <span class="preprocessor">#endif // !DBG</span>
00476 <span class="preprocessor"></span>
00477 <span class="comment">//</span>
00478 <span class="comment">// Function prototypes from devctl.c</span>
00479 <span class="comment">//</span>
00480 
00481 NTSTATUS Ext2FsdDeviceControl (IN PFSD_IRP_CONTEXT IrpContext);
00482 
00483 NTSTATUS Ext2FsdPrepareToUnload (IN PFSD_IRP_CONTEXT IrpContext);
00484 
00485 NTSTATUS Ext2FsdDeviceControlNormal (IN PFSD_IRP_CONTEXT IrpContext);
00486 
00487 NTSTATUS Ext2FsdDeviceControlCompletion (IN PDEVICE_OBJECT DeviceObject,
00488                                          IN PIRP Irp, IN PVOID Context);
00489 
00490 <span class="comment">//</span>
00491 <span class="comment">// Function prototypes from dirctl.c</span>
00492 <span class="comment">//</span>
00493 
00494 NTSTATUS Ext2FsdDirectoryControl (IN PFSD_IRP_CONTEXT IrpContext);
00495 
00496 NTSTATUS Ext2FsdQueryDirectory (IN PFSD_IRP_CONTEXT IrpContext);
00497 
00498 NTSTATUS Ext2FsdNotifyChangeDirectory (IN PFSD_IRP_CONTEXT IrpContext);
00499 
00500 <span class="comment">//</span>
00501 <span class="comment">// Function prototypes from fileinfo.c</span>
00502 <span class="comment">//</span>
00503 
00504 NTSTATUS Ext2FsdQueryInformation (IN PFSD_IRP_CONTEXT IrpContext);
00505 
00506 NTSTATUS Ext2FsdSetInformation (IN PFSD_IRP_CONTEXT IrpContext);
00507 
00508 <span class="comment">//</span>
00509 <span class="comment">// Function prototypes from fsctl.c</span>
00510 <span class="comment">//</span>
00511 
00512 NTSTATUS Ext2FsdFileSystemControl (IN PFSD_IRP_CONTEXT IrpContext);
00513 
00514 NTSTATUS Ext2FsdUserFsRequest (IN PFSD_IRP_CONTEXT IrpContext);
00515 
00516 NTSTATUS Ext2FsdLockVolume (IN PFSD_IRP_CONTEXT IrpContext);
00517 
00518 NTSTATUS Ext2FsdUnlockVolume (IN PFSD_IRP_CONTEXT IrpContext);
00519 
00520 NTSTATUS Ext2FsdDismountVolume (IN PFSD_IRP_CONTEXT IrpContext);
00521 
00522 NTSTATUS Ext2FsdIsVolumeMounted (IN PFSD_IRP_CONTEXT IrpContext);
00523 
00524 NTSTATUS Ext2FsdMountVolume (IN PFSD_IRP_CONTEXT IrpContext);
00525 
00526 NTSTATUS Ext2FsdVerifyVolume (IN PFSD_IRP_CONTEXT IrpContext);
00527 
00528 VOID FsdPurgeVolume (IN PFSD_VCB Vcb, IN BOOLEAN FlushBeforePurge);
00529 
00530 VOID FsdPurgeFile (IN PFSD_FCB Fcb, IN BOOLEAN FlushBeforePurge);
00531 
00532 VOID FsdSetVpbFlag (IN PVPB Vpb, IN USHORT Flag);
00533 
00534 VOID FsdClearVpbFlag (IN PVPB Vpb, IN USHORT Flag);
00535 
00536 <span class="comment">//</span>
00537 <span class="comment">// Function prototypes from fsd.c</span>
00538 <span class="comment">//</span>
00539 
00540 NTSTATUS Ext2FsdBuildRequest (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp);
00541 
00542 NTSTATUS FsdQueueRequest (IN PFSD_IRP_CONTEXT IrpContext);
00543 
00544 VOID FsdDeQueueRequest (IN PVOID Context);
00545 
00546 NTSTATUS FsdDispatchRequest (IN PFSD_IRP_CONTEXT IrpContext);
00547 
00548 NTSTATUS FsdExceptionFilter (IN PFSD_IRP_CONTEXT IrpContext,
00549                              IN NTSTATUS ExceptionCode);
00550 
00551 NTSTATUS FsdExceptionHandler (IN PFSD_IRP_CONTEXT IrpContext);
00552 
00553 NTSTATUS FsdLockUserBuffer (IN PIRP Irp, IN ULONG Length,
00554                             IN LOCK_OPERATION Operation);
00555 
00556 PVOID FsdGetUserBuffer (IN PIRP Irp);
00557 
00558 <span class="comment">//</span>
00559 <span class="comment">// Function prototypes from init.c</span>
00560 <span class="comment">//</span>
00561 
00562 NTSTATUS <a class="code" href="init_8c.html#a1">DriverEntry</a> (IN PDRIVER_OBJECT DriverObject,
00563                       IN PUNICODE_STRING RegistryPath);
00564 
00565 VOID DriverUnload (IN PDRIVER_OBJECT DriverObject);
00566 
00567 <span class="comment">//</span>
00568 <span class="comment">// Function prototypes from inode.c</span>
00569 <span class="comment">//</span>
00570 NTSTATUS <a class="code" href="inode_8c.html#a14">Ext2FsdCreateInode</a> (IN PFSD_IRP_CONTEXT IrpContext, IN PFSD_VCB Vcb,
00571                              IN OUT PFSD_FCB pParentFcb, IN ULONG found_index,
00572                              IN ULONG Type, IN ULONG FileAttr,
00573                              IN PUNICODE_STRING FileName);
00574 
00575 BOOLEAN <a class="code" href="inode_8c.html#a15">Ext2FsdNewInode</a> (PFSD_IRP_CONTEXT IrpContext, PFSD_VCB Vcb,
00576                          ULONG GroupHint, ULONG Type, PULONG Inode);
00577 
00578 BOOLEAN <a class="code" href="inode_8c.html#a17">Ext2FsdDeleteInode</a> (PFSD_IRP_CONTEXT IrpContext, PFSD_VCB Vcb,
00579                             ULONG Inode, ULONG Type);
00580 
00581 NTSTATUS <a class="code" href="inode_8c.html#a16">Ext2FsdAddEntry</a> (IN PFSD_IRP_CONTEXT IrpContext, IN PFSD_VCB Vcb,
00582                           IN PFSD_FCB Dcb, IN ULONG FileType, IN ULONG Inode,
00583                           IN PUNICODE_STRING FileName);
00584 
00585 NTSTATUS <a class="code" href="inode_8c.html#a18">Ext2FsdRemoveEntry</a> (IN PFSD_IRP_CONTEXT IrpContext, IN PFSD_VCB Vcb,
00586                              IN PFSD_FCB Dcb, IN ULONG Inode);
00587 
00588 BOOLEAN <a class="code" href="inode_8c.html#a19">Ext2FsdSaveGroup</a> (IN PFSD_IRP_CONTEXT IrpContext, IN PFSD_VCB Vcb);
00589 
00590 BOOLEAN <a class="code" href="inode_8c.html#a20">Ext2FsdSaveInode</a> (IN PFSD_IRP_CONTEXT IrpContext, IN PFSD_VCB Vcb,
00591                           IN ULONG Inode, IN inode_t * inode);
00592 
00593 BOOLEAN <a class="code" href="inode_8c.html#a21">Ext2FsdSaveSuper</a> (IN PFSD_IRP_CONTEXT IrpContext, IN PFSD_VCB Vcb);
00594 
00595 BOOLEAN <a class="code" href="inode_8c.html#a22">Ext2FsdGetInodeLba</a> (IN PFSD_VCB vcb, IN ULONG inode,
00596                             OUT PLONGLONG offset);
00597 
00598 <span class="comment">//</span>
00599 <span class="comment">// Function prototypes from lockctl.c</span>
00600 <span class="comment">//</span>
00601 
00602 NTSTATUS Ext2FsdLockControl (IN PFSD_IRP_CONTEXT IrpContext);
00603 
00604 <span class="comment">//</span>
00605 <span class="comment">// Function prototypes from read.c</span>
00606 <span class="comment">//</span>
00607 
00608 NTSTATUS Ext2FsdRead (IN PFSD_IRP_CONTEXT IrpContext);
00609 
00610 NTSTATUS Ext2FsdReadNormal (IN PFSD_IRP_CONTEXT IrpContext);
00611 
00612 NTSTATUS Ext2FsdReadComplete (IN PFSD_IRP_CONTEXT IrpContext);
00613 
00614 <span class="comment">//</span>
00615 <span class="comment">// Function prototypes from volinfo.c</span>
00616 <span class="comment">//</span>
00617 
00618 NTSTATUS Ext2FsdQueryVolumeInformation (IN PFSD_IRP_CONTEXT IrpContext);
00619 
00620 <span class="comment">// </span>
00621 <span class="comment">// Function prototypes from write.c</span>
00622 <span class="comment">// </span>
00623 NTSTATUS <a class="code" href="write_8c.html#a0">FsdWrite</a> (IN PFSD_IRP_CONTEXT IrpContext);
00624 
00625 NTSTATUS <a class="code" href="write_8c.html#a1">FsdWriteNormal</a> (IN PFSD_IRP_CONTEXT IrpContext);
00626 
00627 NTSTATUS <a class="code" href="write_8c.html#a2">FsdWriteComplete</a> (IN PFSD_IRP_CONTEXT IrpContext);
00628 
00629 
00630 <span class="comment">//</span>
00631 <span class="comment">// These declarations is missing in some versions of the DDK and ntifs.h</span>
00632 <span class="comment">//</span>
00633 
00634 <span class="preprocessor">#ifndef IoCopyCurrentIrpStackLocationToNext</span>
00635 <span class="preprocessor"></span><span class="preprocessor">#define IoCopyCurrentIrpStackLocationToNext( Irp ) { \</span>
00636 <span class="preprocessor">    PIO_STACK_LOCATION irpSp; \</span>
00637 <span class="preprocessor">    PIO_STACK_LOCATION nextIrpSp; \</span>
00638 <span class="preprocessor">    irpSp = IoGetCurrentIrpStackLocation( (Irp) ); \</span>
00639 <span class="preprocessor">    nextIrpSp = IoGetNextIrpStackLocation( (Irp) ); \</span>
00640 <span class="preprocessor">    RtlCopyMemory( \</span>
00641 <span class="preprocessor">        nextIrpSp, \</span>
00642 <span class="preprocessor">        irpSp, \</span>
00643 <span class="preprocessor">        FIELD_OFFSET(IO_STACK_LOCATION, CompletionRoutine) \</span>
00644 <span class="preprocessor">        ); \</span>
00645 <span class="preprocessor">    nextIrpSp-&gt;Control = 0; }</span>
00646 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00647 <span class="preprocessor"></span>
00648 <span class="preprocessor">#ifndef IoSkipCurrentIrpStackLocation</span>
00649 <span class="preprocessor"></span><span class="preprocessor">#define IoSkipCurrentIrpStackLocation( Irp ) \</span>
00650 <span class="preprocessor">    (Irp)-&gt;CurrentLocation++; \</span>
00651 <span class="preprocessor">    (Irp)-&gt;Tail.Overlay.CurrentStackLocation++;</span>
00652 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00653 <span class="preprocessor"></span>
00654 NTKERNELAPI VOID FsRtlNotifyChangeDirectory (IN PNOTIFY_SYNC NotifySync,
00655                                              IN PVOID FsContext,
00656                                              IN PSTRING FullDirectoryName,
00657                                              IN PLIST_ENTRY NotifyList,
00658                                              IN BOOLEAN WatchTree,
00659                                              IN ULONG CompletionFilter,
00660                                              IN PIRP NotifyIrp);
00661 
00662 <span class="preprocessor">#ifndef RtlUshortByteSwap</span>
00663 <span class="preprocessor"></span>USHORT FASTCALL RtlUshortByteSwap (IN USHORT Source);
00664 <span class="preprocessor">#endif</span>
00665 <span class="preprocessor"></span>
00666 <span class="preprocessor">#ifndef RtlUlongByteSwap</span>
00667 <span class="preprocessor"></span>ULONG FASTCALL RtlUlongByteSwap (IN ULONG Source);
00668 <span class="preprocessor">#endif</span>
00669 <span class="preprocessor"></span>
00670 <span class="preprocessor">#ifndef RtlUlonglongByteSwap</span>
00671 <span class="preprocessor"></span>ULONGLONG FASTCALL RtlUlonglongByteSwap (IN ULONGLONG Source);
00672 <span class="preprocessor">#endif</span>
00673 <span class="preprocessor"></span>
00674 <span class="preprocessor">#endif</span>
</pre></div><hr><address style="align: right;"><small>Generated on Wed Jul 2 17:19:24 2003 for Ext2Fsd by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3 </small></address>
</body>
</html>
